---
// src/components/common/Button.astro
// Reusable button component with multiple variants and states

export interface Props {
  /** Visual variant of the button */
  variant?: "primary" | "secondary" | "ghost" | "link";
  /** Size of the button */
  size?: "sm" | "md" | "lg";
  /** URL for link buttons */
  href?: string;
  /** Whether to download the linked resource */
  download?: boolean | string;
  /** Whether the link opens in a new tab */
  external?: boolean;
  /** Disabled state */
  disabled?: boolean;
  /** Button type (for form buttons) */
  type?: "button" | "submit" | "reset";
  /** Additional CSS classes */
  class?: string;
  /** Optional FontAwesome icon class */
  icon?: string;
  /** Icon position */
  iconPosition?: "left" | "right";
  /** Aria label for accessibility */
  ariaLabel?: string;
}

const {
  variant = "primary",
  size = "md",
  href,
  download,
  external = false,
  disabled = false,
  type = "button",
  class: className = "",
  icon,
  iconPosition = "left",
  ariaLabel,
} = Astro.props;

const isLink = !!href;

const sizeClasses = {
  sm: "btn-sm",
  md: "btn-md",
  lg: "btn-lg",
};

const variantClasses = {
  primary: "btn-primary",
  secondary: "btn-secondary",
  ghost: "btn-ghost",
  link: "btn-link",
};

const classes = [
  "btn",
  sizeClasses[size],
  variantClasses[variant],
  disabled && "btn-disabled",
  className,
]
  .filter(Boolean)
  .join(" ");

const linkProps = isLink
  ? {
      href,
      ...(download && {
        download: typeof download === "string" ? download : "",
      }),
      ...(external && { target: "_blank", rel: "noopener noreferrer" }),
    }
  : {};

const buttonProps = !isLink
  ? {
      type,
      disabled,
    }
  : {};
---

{
  isLink ? (
    <a class={classes} {...linkProps} aria-label={ariaLabel}>
      {icon && iconPosition === "left" && <i class={icon} aria-hidden="true" />}
      <slot />
      {icon && iconPosition === "right" && (
        <i class={icon} aria-hidden="true" />
      )}
    </a>
  ) : (
    <button class={classes} {...buttonProps} aria-label={ariaLabel}>
      {icon && iconPosition === "left" && <i class={icon} aria-hidden="true" />}
      <slot />
      {icon && iconPosition === "right" && (
        <i class={icon} aria-hidden="true" />
      )}
    </button>
  )
}

<style>
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-weight: 600;
    text-decoration: none;
    border-radius: 0;
    cursor: pointer;
    transition:
      transform 0.2s ease,
      box-shadow 0.2s ease,
      opacity 0.2s ease,
      background-color 0.2s ease,
      border-color 0.2s ease,
      color 0.2s ease;
  }

  /* Size variants */
  .btn-sm {
    padding: 0.45rem 0.7rem;
    font-size: 0.85rem;
    min-height: 36px;
  }

  .btn-md {
    padding: 0.65rem 1rem;
    font-size: 0.95rem;
    min-height: 44px;
  }

  .btn-lg {
    padding: 0.85rem 1.5rem;
    font-size: 1rem;
    min-height: 52px;
  }

  /* Primary variant - invert on hover */
  .btn-primary {
    background: var(--text);
    color: var(--bg);
    border: 1px solid var(--text);
  }

  .btn-primary:hover {
    background: transparent;
    color: var(--text);
    transform: translateY(-2px);
  }

  .btn-primary:active {
    transform: translateY(0);
  }

  /* Secondary variant */
  .btn-secondary {
    background: transparent;
    color: var(--text);
    border: 1px solid var(--border);
  }

  .btn-secondary:hover {
    transform: translateY(-2px);
    border-color: var(--text);
  }

  .btn-secondary:active {
    transform: translateY(0);
  }

  /* Ghost variant - invert on hover */
  .btn-ghost {
    background: transparent;
    color: var(--text);
    border: 1px solid var(--border);
  }

  .btn-ghost:hover {
    background: var(--text);
    color: var(--bg);
    border-color: var(--text);
    transform: translateY(-2px);
  }

  .btn-ghost:active {
    transform: translateY(0);
  }

  /* Link variant */
  .btn-link {
    background: transparent;
    color: var(--text);
    border: none;
    padding-left: 0;
    padding-right: 0;
    box-shadow: none;
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .btn-link:hover {
    color: var(--muted);
    transform: none;
  }

  /* Disabled state */
  .btn-disabled,
  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }

  /* Icon styling */
  .btn i {
    font-size: 0.9em;
  }

  /* Focus state for accessibility */
  .btn:focus-visible {
    outline: 2px solid var(--text);
    outline-offset: 2px;
  }

  /* Download button specific styling - ghost style like services page */
  .btn[download] {
    background: transparent;
    color: var(--text);
    border: 1px solid var(--border);
  }

  .btn[download]:hover {
    border-color: var(--text);
  }

  /* Light theme adjustments */
  :global([data-theme="light"]) .btn-primary {
    background: var(--text);
    color: var(--bg);
    border-color: var(--text);
  }

  :global([data-theme="light"]) .btn-primary:hover {
    background: transparent;
    color: var(--text);
  }

  :global([data-theme="light"]) .btn-ghost {
    border-color: var(--border);
  }

  :global([data-theme="light"]) .btn-ghost:hover {
    background: var(--text);
    color: var(--bg);
    border-color: var(--text);
  }

  :global([data-theme="light"]) .btn[download] {
    background: transparent;
    color: var(--text);
    border: 1px solid var(--border);
  }

  :global([data-theme="light"]) .btn[download]:hover {
    border-color: var(--text);
  }

  /* Touch device optimizations */
  @media (hover: none) and (pointer: coarse) {
    .btn:hover {
      transform: none;
      background: inherit;
      color: inherit;
      border-color: inherit;
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn-primary:active {
      background: transparent;
      color: var(--text);
    }

    .btn-ghost:active,
    .btn[download]:active {
      background: var(--text);
      color: var(--bg);
      border-color: var(--text);
    }

    .btn {
      min-height: 44px;
    }
  }
</style>
